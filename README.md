# ASFP-Pro ERP Skeleton

Р­С‚РѕС‚ СЂРµРїРѕР·РёС‚РѕСЂРёР№ СЃРѕРґРµСЂР¶РёС‚ РєР°СЂРєР°СЃ on-prem ERP/CRM/BPM/WMS СЃРёСЃС‚РµРјС‹ РґР»СЏ РєРѕРјРїР°РЅРёРё, Р·Р°РЅРёРјР°СЋС‰РµР№СЃСЏ РЅР°СЂСѓР¶РЅРѕР№ СЂРµРєР»Р°РјРѕР№. РџСЂРѕРµРєС‚ РѕСЂРёРµРЅС‚РёСЂРѕРІР°РЅ РЅР° СЌРєСЃРїР»СѓР°С‚Р°С†РёСЋ РІ СЂРѕСЃСЃРёР№СЃРєРѕР№ СЋСЂРёСЃРґРёРєС†РёРё Рё СЃРѕРѕС‚РІРµС‚СЃС‚РІСѓРµС‚ С‚СЂРµР±РѕРІР°РЅРёСЏРј РїРѕ РёСЃРїРѕР»СЊР·РѕРІР°РЅРёСЋ СЂРѕСЃСЃРёР№СЃРєРёС… РёР»Рё open-source РєРѕРјРїРѕРЅРµРЅС‚РѕРІ.

## Р‘С‹СЃС‚СЂС‹Р№ СЃС‚Р°СЂС‚

```
cp deploy/.env.example deploy/.env
make up
```

РџРµСЂРµРґ Р·Р°РїСѓСЃРєРѕРј СѓР±РµРґРёС‚РµСЃСЊ, С‡С‚Рѕ СѓСЃС‚Р°РЅРѕРІР»РµРЅ [mkcert](https://github.com/FiloSottile/mkcert). `make up` Р°РІС‚РѕРјР°С‚РёС‡РµСЃРєРё РІС‹Р·РѕРІРµС‚ РіРµРЅРµСЂР°С†РёСЋ СЃРµСЂС‚РёС„РёРєР°С‚РѕРІ (С„Р°Р№Р»С‹ РїРѕРїР°РґСѓС‚ РІ `deploy/nginx/certs`).

РџРѕСЃР»Рµ РїРµСЂРІРѕР№ СѓСЃС‚Р°РЅРѕРІРєРё РІС‹РїРѕР»РЅРёС‚Рµ `mkcert -install`, С‡С‚РѕР±С‹ РєРѕСЂРЅРµРІРѕР№ СЃРµСЂС‚РёС„РёРєР°С‚ РїРѕРїР°Р» РІ СЃРёСЃС‚РµРјРЅРѕРµ С…СЂР°РЅРёР»РёС‰Рµ (Р±РµР· СЌС‚РѕРіРѕ HTTPS smoke-С‚РµСЃС‚С‹ РЅРµ РїСЂРѕР№РґСѓС‚).

Р”РѕРїРѕР»РЅРёС‚РµР»СЊРЅС‹Рµ РёРЅСЃС‚СЂСѓРєС†РёРё РґР»СЏ Windows РЅР°С…РѕРґСЏС‚СЃСЏ РІ [docs/setup/windows.md](docs/setup/windows.md).

Р•СЃР»Рё `mkcert` РІСЂРµРјРµРЅРЅРѕ РЅРµРґРѕСЃС‚СѓРїРµРЅ, СѓСЃС‚Р°РЅРѕРІРёС‚Рµ РїРµСЂРµРјРµРЅРЅСѓСЋ `SKIP_MKCERT=1` Рё РІС‹РїРѕР»РЅРёС‚Рµ `make up` РїРѕРІС‚РѕСЂРЅРѕ (HTTPS РІ nginx РїСЂРё СЌС‚РѕРј РёСЃРїРѕР»СЊР·РѕРІР°С‚СЊСЃСЏ РЅРµ Р±СѓРґРµС‚).

РљРѕРјР°РЅРґР° `make up` РїРѕРґРЅРёРјРµС‚ РёРЅС„СЂР°СЃС‚СЂСѓРєС‚СѓСЂСѓ (PostgreSQL 16 (community edition), ClickHouse, Tarantool, Redis, nginx, MinIO) Рё СЃРµСЂРІРёСЃС‹ (`gateway`, `crm`, `wms`). Ceph RGW РїРѕРґРєР»СЋС‡Р°РµС‚СЃСЏ С‡РµСЂРµР· РѕС‚РґРµР»СЊРЅС‹Р№ override, СЃРј. СЂР°Р·РґРµР» В«S3 РІ СЂРµР¶РёРјР°С… СЂР°Р·СЂР°Р±РѕС‚РєРё Рё РїСЂРѕРґР°РєС€РµРЅР°В». РџРѕСЃР»Рµ СѓСЃРїРµС€РЅРѕРіРѕ Р·Р°РїСѓСЃРєР° РґРѕСЃС‚СѓРїРЅС‹:

- http://localhost:8080/health вЂ” СЃРѕСЃС‚РѕСЏРЅРёРµ gateway
- http://localhost:8080/ready вЂ” РїСЂРѕРІРµСЂРєР° Р·Р°РІРёСЃРёРјРѕСЃС‚РµР№ gateway
- http://localhost:8081/health вЂ” СЃРѕСЃС‚РѕСЏРЅРёРµ CRM
- http://localhost:8081/ready вЂ” РїСЂРѕРІРµСЂРєР° Р·Р°РІРёСЃРёРјРѕСЃС‚РµР№ CRM
- http://localhost:8082/health вЂ” СЃРѕСЃС‚РѕСЏРЅРёРµ WMS
- http://localhost:8082/ready вЂ” РїСЂРѕРІРµСЂРєР° Р·Р°РІРёСЃРёРјРѕСЃС‚РµР№ WMS
- http://localhost:8080/openapi.json вЂ” OpenAPI gateway
- http://localhost:8081/openapi.json вЂ” OpenAPI CRM
- http://localhost:8082/openapi.json вЂ” OpenAPI WMS

### РћРіСЂР°РЅРёС‡РµРЅРёСЏ СЂРµСЃСѓСЂСЃРѕРІ РєРѕРЅС‚РµР№РЅРµСЂРѕРІ

- compose-С„Р°Р№Р» Р·Р°РґР°С‘С‚ Р±Р°Р·РѕРІС‹Рµ Р»РёРјРёС‚С‹ РїРѕ CPU/РїР°РјСЏС‚Рё (СЃРј. `mem_limit` Рё `cpus` РІ `deploy/docker-compose.yml`), С‡С‚РѕР±С‹ РѕРєСЂСѓР¶РµРЅРёРµ РЅРµ РІС‹Р¶РёСЂР°Р»Рѕ РІСЃСЋ РјР°С€РёРЅСѓ.
- Р—РЅР°С‡РµРЅРёСЏ РїРѕРґРѕР±СЂР°РЅС‹ РґР»СЏ Р»РѕРєР°Р»СЊРЅРѕР№ СЂР°Р·СЂР°Р±РѕС‚РєРё (Postgres/ClickHouse в‰€ 1.5вЂ“2 CPU, 1.5вЂ“2 Р“Р‘, СЃРµСЂРІРёСЃС‹ вЂ” 0.5вЂ“0.75 CPU, 512 РњР‘); РїСЂРё РЅРµРѕР±С…РѕРґРёРјРѕСЃС‚Рё СЃРєРѕСЂСЂРµРєС‚РёСЂСѓР№С‚Рµ Рё РїРµСЂРµР·Р°РїСѓСЃС‚РёС‚Рµ `make up`.
- Р”Р»СЏ РІСЂРµРјРµРЅРЅРѕРіРѕ РёР·РјРµРЅРµРЅРёСЏ РјРѕР¶РЅРѕ СЃРѕР·РґР°С‚СЊ `docker-compose.override.yml` Рё РїРµСЂРµРѕРїСЂРµРґРµР»РёС‚СЊ РЅСѓР¶РЅС‹Рµ РїРѕР»СЏ.

## РђСЂС…РёС‚РµРєС‚СѓСЂР°

- РњРѕРґСѓР»СЊРЅС‹Р№ РјРѕРЅРѕР»РёС‚ СЃ Р¶С‘СЃС‚РєРёРјРё DDD-РіСЂР°РЅРёС†Р°РјРё Рё СЃРѕР±С‹С‚РёР№РЅРѕР№ РёРЅС‚РµРіСЂР°С†РёРµР№ С‡РµСЂРµР· Tarantool queue (outbox РїСѓР±Р»РёРєСѓРµС‚ СЃРѕР±С‹С‚РёСЏ, РїРѕРґРїРёСЃС‡РёРєРё РёРґРµРјРїРѕС‚РµРЅС‚РЅС‹).
- OLTP вЂ” PostgreSQL 16 (community edition) 16, РјРёРіСЂР°С†РёРё С‡РµСЂРµР· goose (`pkg/db/migrations` РґР»СЏ core Рё `modules/*/migrations`).
- OLAP вЂ” ClickHouse 24.x, РїСЂРёРјРµСЂ РїРѕС‚СЂРµР±РёС‚РµР»СЏ СЃРѕР±С‹С‚РёР№ РІ `modules/analytics` Р·Р°РїРёСЃС‹РІР°РµС‚ `DealCreated` РІ `analytics.events`.
- Р¤Р°Р№Р»С‹ вЂ” Ceph RGW СЃ РїРѕРґРґРµСЂР¶РєРѕР№ РІРµСЂСЃРёРѕРЅРёСЂРѕРІР°РЅРёСЏ. РџСЂРёРјРµСЂ Р·Р°РіСЂСѓР·РєРё РґРѕСЃС‚СѓРїРµРЅ РїРѕ `/api/v1/files` РІ gateway.

## РћСЃРЅРѕРІРЅС‹Рµ РґРёСЂРµРєС‚РѕСЂРёРё

- `gateway` вЂ” API-С€Р»СЋР·, Р°РІС‚РѕСЂРёР·Р°С†РёСЏ, Р·Р°РіСЂСѓР·РєР° С„Р°Р№Р»РѕРІ, РїСЂРѕРєСЃРёСЂРѕРІР°РЅРёРµ РјРѕРґСѓР»РµР№.
- `modules/crm` вЂ” Р±Р°Р·РѕРІР°СЏ CRM: РєРѕРЅС‚СЂР°РіРµРЅС‚С‹, СЃРґРµР»РєРё, СЃРѕР±С‹С‚РёСЏ, РїСѓР±Р»РёРєР°С†РёСЏ `DealCreated`.
- `modules/wms` — WMS: склады, остатки, резервы, динамические каталоги и атрибуты.
- `modules/analytics` вЂ” РїРѕРґРїРёСЃС‡РёРє РѕС‡РµСЂРµРґРё, СЃРєР»Р°РґРёСЂСѓРµС‚ СЃРѕР±С‹С‚РёСЏ РІ ClickHouse.
- `pkg` вЂ” РѕР±С‰РёРµ РїР°РєРµС‚С‹: РєРѕРЅС„РёРіСѓСЂР°С†РёСЏ, Р»РѕРіРё, РїРѕРґРєР»СЋС‡РµРЅРёСЏ Рє Р‘Р”/РѕС‡РµСЂРµРґСЏРј/S3, RBAC РјРѕРґРµР»Рё.
- `deploy` вЂ” docker-compose, РѕРєСЂСѓР¶РµРЅРёРµ, init-СЃРєСЂРёРїС‚С‹, РєРѕРЅС„РёРіСѓСЂР°С†РёСЏ nginx.

## РўРµСЃС‚С‹ Рё РєР°С‡РµСЃС‚РІРѕ

- `make test` вЂ” unit Рё РёРЅС‚РµРіСЂР°С†РёРѕРЅРЅС‹Рµ С‚РµСЃС‚С‹, РѕС‚С‡С‘С‚ Рѕ РїРѕРєСЂС‹С‚РёРё.
- `make lint` вЂ” Р·Р°РїСѓСЃРє `golangci-lint` (РґРѕР»Р¶РµРЅ Р±С‹С‚СЊ СѓСЃС‚Р°РЅРѕРІР»РµРЅ Р»РѕРєР°Р»СЊРЅРѕ).
- `tests/` вЂ” РІСЃРїРѕРјРѕРіР°С‚РµР»СЊРЅС‹Рµ СЃС†РµРЅР°СЂРёРё, РјРѕРєРѕРІС‹Рµ РґР°РЅРЅС‹Рµ.

## CI Рё smoke

- GitHub Actions РІС‹РїРѕР»РЅСЏРµС‚ gofmt/go test РґР»СЏ РєР°Р¶РґРѕРіРѕ push/PR (РёСЃРїРѕР»СЊР·СѓРµС‚СЃСЏ GOTOOLCHAIN=auto, РєРµС€РёСЂСѓСЋС‚СЃСЏ `~/go/pkg/mod`, `~/.cache/go-build` Рё СЃР»РѕРё buildx).
- job `smoke` СЂР°Р·РІРѕСЂР°С‡РёРІР°РµС‚ Docker Compose СЃС‚РµРЅРґ, СЃР±СЂР°СЃС‹РІР°РµС‚ MinIO С‡РµСЂРµР· `scripts/minio-reset.sh`, РїСЂРѕРіРѕРЅСЏРµС‚ smoke-СЃС†РµРЅР°СЂРёРё Рё СЃРѕС…СЂР°РЅСЏРµС‚ Р°СЂС‚РµС„Р°РєС‚С‹ РІ `tests/smoke/artifacts`.
- РџРѕ СЃРѕСЃС‚РѕСЏРЅРёСЋ РЅР° 2025-09-27 smoke РѕСЃС‚Р°С‘С‚СЃСЏ РЅРµСЃС‚Р°Р±РёР»СЊРЅС‹Рј РёР·-Р·Р° РґРѕСЂР°Р±РѕС‚РѕРє WMS (СЃРј. PROGRESS.md), РїРѕСЌС‚РѕРјСѓ СЂРµР·СѓР»СЊС‚Р°С‚С‹ job СЃС‚РѕРёС‚ РїСЂРѕРІРµСЂСЏС‚СЊ РІСЂСѓС‡РЅСѓСЋ.
- Smoke-пакет дополнен CRUD-сценариями WMS мастер-данных (каталоги, товары, динамические атрибуты).
- Р”Р»СЏ Р»РѕРєР°Р»СЊРЅРѕР№ РїСЂРѕРІРµСЂРєРё HTTPS РёСЃРїРѕР»СЊР·СѓР№С‚Рµ `mkcert -install`, Р·Р°С‚РµРј `SMOKE_GATEWAY_HTTPS_URL=https://localhost:8443 make smoke`.

## РЎР»РµРґСѓСЋС‰РёРµ С€Р°РіРё

1. Р РµР°Р»РёР·РѕРІР°С‚СЊ РїРѕР»РЅРѕС†РµРЅРЅС‹Р№ RBAC Рё Р°СѓРґРёС‚ (РёСЃС‚РѕСЂРёСЏ РІ `core.audit_log`).
2. Р”РѕР±Р°РІРёС‚СЊ BPMN-РёСЃРїРѕР»РЅРёС‚РµР»СЊ Рё РІРёР·СѓР°Р»СЊРЅС‹Р№ СЂРµРґР°РєС‚РѕСЂ РїСЂРѕС†РµСЃСЃРѕРІ.
3. РќР°СЃС‚СЂРѕРёС‚СЊ РІРёС‚СЂРёРЅС‹ ClickHouse Рё РґР°С€Р±РѕСЂРґС‹ РІ Superset/Metabase.
4. РџРѕРґРіРѕС‚РѕРІРёС‚СЊ РєРѕРЅС‚СѓСЂС‹ РёРЅС‚РµРіСЂР°С†РёРё СЃ Р‘РёС‚СЂРёРєСЃ24 Рё 1РЎ.

РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” РІ РєРѕРјРјРµРЅС‚Р°СЂРёСЏС… Рє РєРѕРґСѓ Рё РґРѕРєСѓРјРµРЅС‚Р°С†РёРё РІРЅСѓС‚СЂРё РјРѕРґСѓР»РµР№.

## РџРѕР»РёС‚РёРєР° РёСЃРїРѕР»СЊР·РѕРІР°РЅРёСЏ РЎРЈР‘Р”

- Р”Р»СЏ СЂР°Р·СЂР°Р±РѕС‚РєРё Рё С‚РµСЃС‚РѕРІС‹С… СЃС‚РµРЅРґРѕРІ РёСЃРїРѕР»СЊР·СѓРµС‚СЃСЏ РѕС‚РєСЂС‹С‚Р°СЏ СЃР±РѕСЂРєР° `postgres:16` РёР· Docker Hub.
- Р’СЃРµ СЃС…РµРјС‹, РјРёРіСЂР°С†РёРё Рё SQL-Р·Р°РїСЂРѕСЃС‹ РґРѕР»Р¶РЅС‹ РѕСЃС‚Р°РІР°С‚СЊСЃСЏ СЃРѕРІРјРµСЃС‚РёРјС‹РјРё СЃ Р±Р°Р·РѕРІС‹Рј PostgreSQL (Р±РµР· СЂР°СЃС€РёСЂРµРЅРёР№/РїР°СЂР°РјРµС‚СЂРѕРІ, РґРѕСЃС‚СѓРїРЅС‹С… С‚РѕР»СЊРєРѕ РІ Postgres Pro).
- РџСЂРё РїРµСЂРµС…РѕРґРµ РЅР° Postgres Pro РґРѕРїСѓСЃРєР°РµС‚СЃСЏ Р·Р°РјРµРЅР° РѕР±СЂР°Р·Р° Рё РїРµСЂРµРЅР°СЃС‚СЂРѕР№РєР° РїР°СЂР°РјРµС‚СЂРѕРІ, РЅРѕ СЃС‚СЂСѓРєС‚СѓСЂР° РґР°РЅРЅС‹С… Рё РєРѕРґ РѕСЃС‚Р°СЋС‚СЃСЏ РЅРµРёР·РјРµРЅРЅС‹РјРё.
- Р›СЋР±С‹Рµ РёСЃРєР»СЋС‡РµРЅРёСЏ С„РёРєСЃРёСЂСѓСЋС‚СЃСЏ РѕС‚РґРµР»СЊРЅРѕ Рё СЃРѕРіР»Р°СЃСѓСЋС‚СЃСЏ СЃ Р°СЂС…РёС‚РµРєС‚РѕСЂРѕРј.


### S3 РІ СЂРµР¶РёРјР°С… СЂР°Р·СЂР°Р±РѕС‚РєРё Рё РїСЂРѕРґР°РєС€РµРЅР°

- РџРѕ СѓРјРѕР»С‡Р°РЅРёСЋ `make up` Р·Р°РїСѓСЃРєР°РµС‚ `minio/minio` (API-СЃРѕРІРјРµСЃС‚РёРјС‹Р№ СЂРµР¶РёРј) РґР»СЏ Р»РѕРєР°Р»СЊРЅРѕРіРѕ СЃС‚РµРЅРґР°. РџРµСЂРµРјРµРЅРЅС‹Рµ РѕРєСЂСѓР¶РµРЅРёСЏ РїРѕ СѓРјРѕР»С‡Р°РЅРёСЋ РЅР°С…РѕРґСЏС‚СЃСЏ РІ `deploy/.env.example`.
- Р”Р»СЏ РїСЂРѕРґР°РєС€РµРЅР° РїРѕРґРіРѕС‚РѕРІР»РµРЅ override-С„Р°Р№Р» `deploy/docker-compose.ceph.yml`, РїРµСЂРµРєР»СЋС‡Р°СЋС‰РёР№ СЃРµСЂРІРёСЃ `ceph` РЅР° РѕР±СЂР°Р· `quay.io/ceph/demo`. РџСЂРёРјРµСЂ РїРµСЂРµРјРµРЅРЅС‹С… вЂ” РІ `deploy/.env.ceph.example`.
- РџРµСЂРµРґ Р·Р°РїСѓСЃРєРѕРј Ceph RGW РЅРµРѕР±С…РѕРґРёРјРѕ Р·Р°РґР°С‚СЊ РєРѕСЂСЂРµРєС‚РЅС‹Рµ `CEPH_MON_IP`, `CEPH_PUBLIC_NETWORK` Рё `CEPH_CLUSTER_NETWORK`, СЃРѕРѕС‚РІРµС‚СЃС‚РІСѓСЋС‰РёРµ Р°РґСЂРµСЃСѓ С…РѕСЃС‚Р°/РїРѕРґСЃРµС‚Рё, РіРґРµ СЂР°Р·РІС‘СЂРЅСѓС‚ compose.
- Ceph demo-РєРѕРЅС‚РµР№РЅРµСЂ Р°РІС‚РѕРјР°С‚РёС‡РµСЃРєРё СЃРѕР·РґР°С‘С‚ bucket `S3_BUCKET` Рё РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ `CEPH_DEMO_UID`, РїРѕСЌС‚РѕРјСѓ РїСЂРёР»РѕР¶РµРЅРёСЏ Р±СѓРґСѓС‚ СЂР°Р±РѕС‚Р°С‚СЊ СЃ С‚РµРјРё Р¶Рµ `S3_ACCESS_KEY`/`S3_SECRET_KEY`, С‡С‚Рѕ СѓРєР°Р·Р°РЅС‹ РІ `.env`.
- Р”Р»СЏ Р·Р°РїСѓСЃРєР° prod-СЃС‚РµРєР°: `docker compose --env-file deploy/.env.ceph.example -f deploy/docker-compose.yml -f deploy/docker-compose.ceph.yml up -d`.


### РџСЂР°РІРёР»Р° С„РёРєСЃР°С†РёРё РїСЂРѕРіСЂРµСЃСЃР°
- РџРѕСЃР»Рµ РєР°Р¶РґРѕРіРѕ Р·Р°РІРµСЂС€РµРЅРЅРѕРіРѕ С€Р°РіР° РѕР±СЏР·Р°С‚РµР»СЊРЅРѕ РґРѕР±Р°РІР»СЏР№С‚Рµ Р·Р°РїРёСЃСЊ РІ С„Р°Р№Р» PROGRESS.md.

